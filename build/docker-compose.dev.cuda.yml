# Docker compose configuration with desktop gpu support for ROS development
# Nvidia only, WSL + Linux

include:
  - docker-compose.carla.cuda.yaml

services:
  agent-dev:
    extends:
      file: docker-compose.dev.base.yml
      service: agent-dev
    build:
      args:
        PAF_USERNAME: ${PAF_USERNAME}
        PAF_UID: ${PAF_UID}
        PAF_GID: ${PAF_GID}
        BASE_FLAVOUR: cuda
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: "all"
              capabilities: [ gpu ]
    volumes:
      # This should not be necessary: https://github.com/NVIDIA/nvidia-container-toolkit/issues/16
      - /usr/share/vulkan/icd.d/nvidia_icd.json:/usr/share/vulkan/icd.d/nvidia_icd.json
    # Uncomment below if you also have intel/amd integrated graphics (Laptop)
    # devices:
    #   - /dev/dri
