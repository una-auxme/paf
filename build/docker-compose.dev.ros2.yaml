include:
  - docker-compose.carla-simulator.yaml

services:
  agent-dev:
    # Set the image name so different users don't collide
    image: agent-dev-${PAF_USERNAME}
    build:
      dockerfile: build/docker/agent-ros2/Dockerfile
      context: ../
      args:
        PAF_USERNAME: ${PAF_USERNAME}
        PAF_UID: ${PAF_UID}
        PAF_GID: ${PAF_GID}
      target: agent-dev
    shm_size: 2gb
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: "all"
              capabilities: [ gpu ]
    volumes:
      - ../:/workspace
      - /tmp/.X11-unix:/tmp/.X11-unix:ro
      - ${XDG_RUNTIME_DIR}:${XDG_RUNTIME_DIR}
    environment:
      - DESKTOP_SESSION
      - DISPLAY
      - XDG_SESSION_DESKTOP
      - XDG_SESSION_TYPE
      - XAUTHORITY
      - XDG_CURRENT_DESKTOP
      - XDG_SESSION_CLASS
      - XDG_RUNTIME_DIR
    command: |
      bash -c " \
        (rqt &) && \
        rviz2 -d /workspace/rviz2.rviz \
      "
    networks:
      - carla

networks:
  carla:
