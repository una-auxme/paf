name: Lint python code with ruff

on:
  pull_request:
    branches:
      - main
  push:
    branches:
      - main

jobs:
  ruff:
    name: Lint python code with ruff
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Load Ruff version
        run: |
          VERSION_LINE=$(grep -E '^RUFF_VERSION=' build/pins/ruff.env || true)
          VERSION=${VERSION_LINE#RUFF_VERSION=}
          if [ -z "${VERSION}" ]; then
            echo "Ruff version missing in build/pins/ruff.env" >&2
            exit 1
          fi
          echo "RUFF_VERSION=${VERSION}" >> "$GITHUB_ENV"
      - name: install ruff
        uses: astral-sh/ruff-action@v3
        with:
          version: ${{ env.RUFF_VERSION }}
      - name: Ruff lint check statistics
        run: ruff check --statistics .
      - name: Check formatting with Ruff
        run: ruff format --check .
